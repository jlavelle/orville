<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Orville.PostgreSQL.Plan</span><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#askParam"><span class="hs-identifier hs-var">askParam</span></a><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-comment">-- * Using a Plan after it is constructed</span><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#execute"><span class="hs-identifier hs-var">execute</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#explain"><span class="hs-identifier hs-var">explain</span></a><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-comment">-- * Making a Plan to find rows in the database</span><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#findMaybeOne"><span class="hs-identifier hs-var">findMaybeOne</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#findMaybeOneWhere"><span class="hs-identifier hs-var">findMaybeOneWhere</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#findOne"><span class="hs-identifier hs-var">findOne</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#findOneWhere"><span class="hs-identifier hs-var">findOneWhere</span></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#findAll"><span class="hs-identifier hs-var">findAll</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#findAllWhere"><span class="hs-identifier hs-var">findAllWhere</span></a><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-comment">-- * Creating a multi-step Plan from other Plan values</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#bind"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#use"><span class="hs-identifier hs-var">use</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#using"><span class="hs-identifier hs-var">using</span></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#chain"><span class="hs-identifier hs-var">chain</span></a><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#apply"><span class="hs-identifier hs-var">apply</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#planMany"><span class="hs-identifier hs-var">planMany</span></a><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-comment">-- * Bridges from other types into Plan</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-type">Op.AssertionFailed</span></a><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#assert"><span class="hs-identifier hs-var">assert</span></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#planSelect"><span class="hs-identifier hs-var">planSelect</span></a><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier hs-var">planOperation</span></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Catch</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Catch</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Orville.PostgreSQL.Core.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Core</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Core</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><a href="Database.Orville.PostgreSQL.Internal.MappendCompat.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Internal.MappendCompat</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><a href="Database.Orville.PostgreSQL.Plan.Many.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Plan.Many</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Many.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Plan.Many</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Many</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Operation.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Plan.Operation</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Op</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Explanation.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Plan.Explanation</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Exp</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><a href="Database.Orville.PostgreSQL.Select.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Select</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-comment">{-|
  A 'Plan' is an executable set of queries that can be executed to load data
  from the database, using the results of prior queries as input parameters to
  following queries in controlled ways. In particular, the &quot;controlled&quot; aspect
  of this allows plans that take a single input to be adapted to take multiple
  input parameters in a list without the resulting plan executing N+1 queries.
  This restriction means that while query results can be used as input
  parameters to later queries, they cannot be used to decide to run completely
  different queries based on other query results. Allowing this would prevent
  the 'Plan' structure from eliminating N+1 query loops.

  Note that during execution queries are never combined across tables to form
  joins or subqueries. Queries are still executed in the same sequence as
  specified in the plan, just on all the inputs at once rather than in a loop.
  If you need to do a join with a plan, you can always construction your
  own custom 'Op.Operation' and use 'planOperation' to incorporate into a plan.

  The @param@ type variable indicates what type of value is expected as input
  when the plan is executed.

  The @result@ type for a plan indicates what Haskell type is produced
  when the plan is executed.

  The @scope@ type is used internally by Orville to track the plan is currently
  executed against a single input or multiple inputs. This type parameter
  should never specified as a concrete type in user code, but must be exposed
  as a variable to ensure that execute scope is tracked correctly through
  usages of 'bind'.

-}</span><span>
</span><a name="line-75"></a><span class="hs-keyword">data</span><span> </span><a name="Plan"><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier">Plan</span></a></a><span> </span><a name="local-6989586621679142043"><a href="#local-6989586621679142043"><span class="hs-identifier">scope</span></a></a><span> </span><a name="local-6989586621679142044"><a href="#local-6989586621679142044"><span class="hs-identifier">param</span></a></a><span> </span><a name="local-6989586621679142045"><a href="#local-6989586621679142045"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-76"></a><span>  </span><a name="PlanOp"><a href="Database.Orville.PostgreSQL.Plan.html#PlanOp"><span class="hs-identifier">PlanOp</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Op.Operation</span></a><span> </span><a href="#local-6989586621679142046"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142047"><span class="hs-identifier hs-type">result</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142048"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142046"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142047"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>  </span><a name="PlanMany"><a href="Database.Orville.PostgreSQL.Plan.html#PlanMany"><span class="hs-identifier">PlanMany</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679142052"><a href="#local-6989586621679142052"><span class="hs-identifier">manyScope</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142052"><span class="hs-identifier hs-type">manyScope</span></a><span> </span><a href="#local-6989586621679142049"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142050"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142051"><span class="hs-identifier hs-type">scope</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679142049"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a><span> </span><a href="#local-6989586621679142049"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142050"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>  </span><a name="Bind"><a href="Database.Orville.PostgreSQL.Plan.html#Bind"><span class="hs-identifier">Bind</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142053"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142054"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142055"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-82"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142053"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142055"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142053"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142054"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142056"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142053"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142054"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142056"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>  </span><a name="Use"><a href="Database.Orville.PostgreSQL.Plan.html#Use"><span class="hs-identifier">Use</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142057"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142058"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142057"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142059"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142058"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>  </span><a name="Pure"><a href="Database.Orville.PostgreSQL.Plan.html#Pure"><span class="hs-identifier">Pure</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679142060"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142061"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142062"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142060"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>  </span><a name="Apply"><a href="Database.Orville.PostgreSQL.Plan.html#Apply"><span class="hs-identifier">Apply</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142063"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142064"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679142065"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142066"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142063"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142064"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142065"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-91"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142063"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142064"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142066"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span>  </span><a name="Chain"><a href="Database.Orville.PostgreSQL.Plan.html#Chain"><span class="hs-identifier">Chain</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142067"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142068"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679142069"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-94"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679142071"><a href="#local-6989586621679142071"><span class="hs-identifier">chainedScope</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142071"><span class="hs-identifier hs-type">chainedScope</span></a><span> </span><a href="#local-6989586621679142069"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679142070"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142067"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142068"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679142070"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142075"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142076"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-98"></a><span>  </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679142077"><a href="#local-6989586621679142077"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#Pure"><span class="hs-identifier hs-var">Pure</span></a><span> </span><a href="#local-6989586621679142077"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142073"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142074"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-101"></a><span>  </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Pure"><span class="hs-identifier hs-var">Pure</span></a><span>
</span><a name="line-102"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">{-|
  'OneScope' is an internal tag type used by as the 'scope' variable for
  'Plan' values when executing them against a single input.
-}</span><span>
</span><a name="line-108"></a><span class="hs-keyword">data</span><span> </span><a name="OneScope"><a href="Database.Orville.PostgreSQL.Plan.html#OneScope"><span class="hs-identifier">OneScope</span></a></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">{-|
  'ManyScope is an internal tag type used by as the 'scope' variable for
  'Plan' values when executing them against multiple inputs.
-}</span><span>
</span><a name="line-114"></a><span class="hs-keyword">data</span><span> </span><a name="ManyScope"><a href="Database.Orville.PostgreSQL.Plan.html#ManyScope"><span class="hs-identifier">ManyScope</span></a></a><span> </span><a name="local-6989586621679142042"><a href="#local-6989586621679142042"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">{-|
  A 'Planned' value is a wrapper around the results of previous run queries
  when using the 'bind' function. At the time that you are writing a plan you
  do not know whether the 'Plan' will be run with a single input or multiple
  inputs. A 'Planned' value may end up being either an individual item or a
  list of items. Due to this, your ability to interact with the value is
  limited to the use of 'fmap' to extract (or build) other values from the
  results. 'Planned' values can be used together with the 'use' function to
  make a 'Plan' that produces the extracted value.

  Note that while 'Planned' could provide an 'Applicative' instance as well, it
  does not to avoid confusion with 'Applicative' instance for 'Plan' itself.
  If you need to build a value from several 'Planned' values using
  'Applicative', you should call 'use' on each of the values and use the
  'Applicative' instance for 'Plan'.
-}</span><span>
</span><a name="line-132"></a><span class="hs-keyword">data</span><span> </span><a name="Planned"><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier">Planned</span></a></a><span> </span><a name="local-6989586621679142036"><a href="#local-6989586621679142036"><span class="hs-identifier">scope</span></a></a><span> </span><a name="local-6989586621679142037"><a href="#local-6989586621679142037"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-133"></a><span>  </span><a name="PlannedOne"><a href="Database.Orville.PostgreSQL.Plan.html#PlannedOne"><span class="hs-identifier">PlannedOne</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679142038"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#OneScope"><span class="hs-identifier hs-type">OneScope</span></a><span> </span><a href="#local-6989586621679142038"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-134"></a><span>  </span><a name="PlannedMany"><a href="Database.Orville.PostgreSQL.Plan.html#PlannedMany"><span class="hs-identifier">PlannedMany</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a><span> </span><a href="#local-6989586621679142039"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679142040"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#ManyScope"><span class="hs-identifier hs-type">ManyScope</span></a><span> </span><a href="#local-6989586621679142039"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679142040"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-135"></a><span>  </span><a name="PlannedExplain"><a href="Database.Orville.PostgreSQL.Plan.html#PlannedExplain"><span class="hs-identifier">PlannedExplain</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Explain"><span class="hs-identifier hs-type">Explain</span></a><span> </span><a href="#local-6989586621679142041"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142072"><span class="hs-identifier hs-type">scope</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-138"></a><span>  </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#mapPlanned"><span class="hs-identifier hs-var">mapPlanned</span></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">{-|
  'mapPlanned' applies a function to what value or values have been produced by
  the plan. This function can also be called as 'fmap' or '&lt;$&gt;' thorugh the
  'Functor' instance for 'Planned'.
-}</span><span>
</span><a name="line-145"></a><span class="hs-identifier">mapPlanned</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679142178"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142179"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142180"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142178"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142180"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142179"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-146"></a><a name="mapPlanned"><a href="Database.Orville.PostgreSQL.Plan.html#mapPlanned"><span class="hs-identifier">mapPlanned</span></a></a><span> </span><a name="local-6989586621679142181"><a href="#local-6989586621679142181"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679142182"><a href="#local-6989586621679142182"><span class="hs-identifier">planned</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142182"><span class="hs-identifier hs-var">planned</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-148"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedOne"><span class="hs-identifier hs-var">PlannedOne</span></a><span> </span><a name="local-6989586621679142183"><a href="#local-6989586621679142183"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-149"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedOne"><span class="hs-identifier hs-var">PlannedOne</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679142181"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679142183"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedMany"><span class="hs-identifier hs-var">PlannedMany</span></a><span> </span><a name="local-6989586621679142184"><a href="#local-6989586621679142184"><span class="hs-identifier">manyAs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-152"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedMany"><span class="hs-identifier hs-var">PlannedMany</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679142181"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679142184"><span class="hs-identifier hs-var">manyAs</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedExplain"><span class="hs-identifier hs-var">PlannedExplain</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-155"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedExplain"><span class="hs-identifier hs-var">PlannedExplain</span></a><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">{-|
  'resolveOne' resolves a 'Planned' value that is known to be in the 'One'
  scope to its single wrapped value.
-}</span><span>
</span><a name="line-161"></a><span class="hs-identifier">resolveOne</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#OneScope"><span class="hs-identifier hs-type">OneScope</span></a><span> </span><a href="#local-6989586621679142177"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142177"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-162"></a><a name="resolveOne"><a href="Database.Orville.PostgreSQL.Plan.html#resolveOne"><span class="hs-identifier">resolveOne</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedOne"><span class="hs-identifier hs-var">PlannedOne</span></a><span> </span><a name="local-6989586621679142185"><a href="#local-6989586621679142185"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679142185"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">{-|
  'resolveMany resolves a 'Planned' value that is known to be in the 'Many'
  scope to the 'Many' value wrapped inside it.
-}</span><span>
</span><a name="line-168"></a><span class="hs-identifier">resolveMany</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#ManyScope"><span class="hs-identifier hs-type">ManyScope</span></a><span> </span><a href="#local-6989586621679142175"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679142176"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a><span> </span><a href="#local-6989586621679142175"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679142176"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-169"></a><a name="resolveMany"><a href="Database.Orville.PostgreSQL.Plan.html#resolveMany"><span class="hs-identifier">resolveMany</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedMany"><span class="hs-identifier hs-var">PlannedMany</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-comment">{-|
  'planOperation' allows any primitive 'Op.Operation' to be used as an atomic step
  in a plan. When the plan is executed, the appropriate 'Op.Operation' functions
  will be used depending on the execution context.
-}</span><span>
</span><a name="line-176"></a><span class="hs-identifier">planOperation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Op.Operation</span></a><span> </span><a href="#local-6989586621679142172"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142173"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-177"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142174"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142172"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142173"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-178"></a><a name="planOperation"><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier">planOperation</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-179"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanOp"><span class="hs-identifier hs-var">PlanOp</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">{-|
  'planSelect' allows any Orville 'Select' query to be incorporated into a
  plan. Note that the 'Select' cannot depend on the plan's input parameters in
  this case. If the plan is executed with multiple inputs the same set of all
  the results will be used as the results for each of the input parameters.
-}</span><span>
</span><a name="line-187"></a><span class="hs-identifier">planSelect</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span> </span><a href="#local-6989586621679142169"><span class="hs-identifier hs-type">row</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142170"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142171"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679142169"><span class="hs-identifier hs-type">row</span></a><span class="hs-special">]</span><span>
</span><a name="line-188"></a><a name="planSelect"><a href="Database.Orville.PostgreSQL.Plan.html#planSelect"><span class="hs-identifier">planSelect</span></a></a><span> </span><a name="local-6989586621679142187"><a href="#local-6989586621679142187"><span class="hs-identifier">select</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-189"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier hs-var">planOperation</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#findSelect"><span class="hs-identifier hs-var">Op.findSelect</span></a><span> </span><a href="#local-6989586621679142187"><span class="hs-identifier hs-var">select</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">{-|
  'askParam' allows the input parameter for the plan to be retrieved as the
  result of the plan. Together with 'bind' you can use this to get access to
  the input parameter as a 'Planned' value.
-}</span><span>
</span><a name="line-196"></a><span class="hs-identifier">askParam</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142167"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142168"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142168"><span class="hs-identifier hs-type">param</span></a><span>
</span><a name="line-197"></a><a name="askParam"><a href="Database.Orville.PostgreSQL.Plan.html#askParam"><span class="hs-identifier">askParam</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-198"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier hs-var">planOperation</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#askParam"><span class="hs-identifier hs-var">Op.askParam</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">{-|
  'findMaybeOne' constructs a 'Plan' that will find at most one row from
  the given table where the plan's input value matches the given database
  field.
-}</span><span>
</span><a name="line-205"></a><span class="hs-identifier">findMaybeOne</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679142161"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-206"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">Core.TableDefinition</span></a><span> </span><a href="#local-6989586621679142162"><span class="hs-identifier hs-type">readEntity</span></a><span> </span><a href="#local-6989586621679142163"><span class="hs-identifier hs-type">writeEntity</span></a><span> </span><a href="#local-6989586621679142164"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-207"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">Core.FieldDefinition</span></a><span> </span><a href="#local-6989586621679142165"><span class="hs-identifier hs-type">nullability</span></a><span> </span><a href="#local-6989586621679142161"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-208"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142166"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142161"><span class="hs-identifier hs-type">fieldValue</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679142162"><span class="hs-identifier hs-type">readEntity</span></a><span class="hs-special">)</span><span>
</span><a name="line-209"></a><a name="findMaybeOne"><a href="Database.Orville.PostgreSQL.Plan.html#findMaybeOne"><span class="hs-identifier">findMaybeOne</span></a></a><span> </span><a name="local-6989586621679142188"><a href="#local-6989586621679142188"><span class="hs-identifier">tableDef</span></a></a><span> </span><a name="local-6989586621679142189"><a href="#local-6989586621679142189"><span class="hs-identifier">fieldDef</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-210"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier hs-var">planOperation</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#findOne"><span class="hs-identifier hs-var">Op.findOne</span></a><span> </span><a href="#local-6989586621679142188"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142189"><span class="hs-identifier hs-var">fieldDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">{-|
  'findMaybeOneWhere' is similar to 'findMaybeOne', but allows a
  'WhereCondition' to be specified to restrict which rows are matched by the
  database query.
-}</span><span>
</span><a name="line-217"></a><span class="hs-identifier">findMaybeOneWhere</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679142155"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-218"></a><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">Core.TableDefinition</span></a><span> </span><a href="#local-6989586621679142156"><span class="hs-identifier hs-type">readEntity</span></a><span> </span><a href="#local-6989586621679142157"><span class="hs-identifier hs-type">writeEntity</span></a><span> </span><a href="#local-6989586621679142158"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-219"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">Core.FieldDefinition</span></a><span> </span><a href="#local-6989586621679142159"><span class="hs-identifier hs-type">nullability</span></a><span> </span><a href="#local-6989586621679142155"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-220"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#WhereCondition"><span class="hs-identifier hs-type">Core.WhereCondition</span></a><span>
</span><a name="line-221"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142160"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142155"><span class="hs-identifier hs-type">fieldValue</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679142156"><span class="hs-identifier hs-type">readEntity</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><a name="findMaybeOneWhere"><a href="Database.Orville.PostgreSQL.Plan.html#findMaybeOneWhere"><span class="hs-identifier">findMaybeOneWhere</span></a></a><span> </span><a name="local-6989586621679142190"><a href="#local-6989586621679142190"><span class="hs-identifier">tableDef</span></a></a><span> </span><a name="local-6989586621679142191"><a href="#local-6989586621679142191"><span class="hs-identifier">fieldDef</span></a></a><span> </span><a name="local-6989586621679142192"><a href="#local-6989586621679142192"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-223"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier hs-var">planOperation</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#findOneWhere"><span class="hs-identifier hs-var">Op.findOneWhere</span></a><span> </span><a href="#local-6989586621679142190"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142191"><span class="hs-identifier hs-var">fieldDef</span></a><span> </span><a href="#local-6989586621679142192"><span class="hs-identifier hs-var">cond</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">{-|
  'findOne' is similar to 'findMaybeOne, but it expects that there will always
  be a row found matching the plan's input value. If no row is found an
  'Op.AssertionFailed' exception will be thrown. This is a useful convenience
  when looking up foreign-key associations that are expected to be enforced
  by the database itself.
-}</span><span>
</span><a name="line-232"></a><span class="hs-identifier">findOne</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679142149"><span class="hs-identifier hs-type">fieldValue</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679142149"><span class="hs-identifier hs-type">fieldValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">Core.TableDefinition</span></a><span> </span><a href="#local-6989586621679142150"><span class="hs-identifier hs-type">readEntity</span></a><span> </span><a href="#local-6989586621679142151"><span class="hs-identifier hs-type">writeEntity</span></a><span> </span><a href="#local-6989586621679142152"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-234"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">Core.FieldDefinition</span></a><span> </span><a href="#local-6989586621679142153"><span class="hs-identifier hs-type">nullability</span></a><span> </span><a href="#local-6989586621679142149"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-235"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142154"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142149"><span class="hs-identifier hs-type">fieldValue</span></a><span> </span><a href="#local-6989586621679142150"><span class="hs-identifier hs-type">readEntity</span></a><span>
</span><a name="line-236"></a><a name="findOne"><a href="Database.Orville.PostgreSQL.Plan.html#findOne"><span class="hs-identifier">findOne</span></a></a><span> </span><a name="local-6989586621679142193"><a href="#local-6989586621679142193"><span class="hs-identifier">tableDef</span></a></a><span> </span><a name="local-6989586621679142194"><a href="#local-6989586621679142194"><span class="hs-identifier">fieldDef</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-237"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#assert"><span class="hs-identifier hs-var">assert</span></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#assertFound"><span class="hs-identifier hs-var">assertFound</span></a><span> </span><a href="#local-6989586621679142193"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142194"><span class="hs-identifier hs-var">fieldDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>    </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#findMaybeOne"><span class="hs-identifier hs-var">findMaybeOne</span></a><span> </span><a href="#local-6989586621679142193"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142194"><span class="hs-identifier hs-var">fieldDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">{-|
  'findOneWhere' is similar to 'findOne', but allows a 'WhereCondition' to be
  specified to restrict which rows are matched by the database query.
-}</span><span>
</span><a name="line-245"></a><span class="hs-identifier">findOneWhere</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679142143"><span class="hs-identifier hs-type">fieldValue</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679142143"><span class="hs-identifier hs-type">fieldValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">Core.TableDefinition</span></a><span> </span><a href="#local-6989586621679142144"><span class="hs-identifier hs-type">readEntity</span></a><span> </span><a href="#local-6989586621679142145"><span class="hs-identifier hs-type">writeEntity</span></a><span> </span><a href="#local-6989586621679142146"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-247"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">Core.FieldDefinition</span></a><span> </span><a href="#local-6989586621679142147"><span class="hs-identifier hs-type">nullability</span></a><span> </span><a href="#local-6989586621679142143"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-248"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#WhereCondition"><span class="hs-identifier hs-type">Core.WhereCondition</span></a><span>
</span><a name="line-249"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142148"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142143"><span class="hs-identifier hs-type">fieldValue</span></a><span> </span><a href="#local-6989586621679142144"><span class="hs-identifier hs-type">readEntity</span></a><span>
</span><a name="line-250"></a><a name="findOneWhere"><a href="Database.Orville.PostgreSQL.Plan.html#findOneWhere"><span class="hs-identifier">findOneWhere</span></a></a><span> </span><a name="local-6989586621679142195"><a href="#local-6989586621679142195"><span class="hs-identifier">tableDef</span></a></a><span> </span><a name="local-6989586621679142196"><a href="#local-6989586621679142196"><span class="hs-identifier">fieldDef</span></a></a><span> </span><a name="local-6989586621679142197"><a href="#local-6989586621679142197"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-251"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#assert"><span class="hs-identifier hs-var">assert</span></a><span>
</span><a name="line-252"></a><span>    </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#assertFound"><span class="hs-identifier hs-var">assertFound</span></a><span> </span><a href="#local-6989586621679142195"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142196"><span class="hs-identifier hs-var">fieldDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>    </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#findMaybeOneWhere"><span class="hs-identifier hs-var">findMaybeOneWhere</span></a><span> </span><a href="#local-6989586621679142195"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142196"><span class="hs-identifier hs-var">fieldDef</span></a><span> </span><a href="#local-6989586621679142197"><span class="hs-identifier hs-var">cond</span></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">{-|
  'assertFound' is an internal helper that checks that row was found where
  one was expected.
-}</span><span>
</span><a name="line-259"></a><span class="hs-identifier">assertFound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679142137"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-260"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">Core.TableDefinition</span></a><span> </span><a href="#local-6989586621679142138"><span class="hs-identifier hs-type">readEntity</span></a><span> </span><a href="#local-6989586621679142139"><span class="hs-identifier hs-type">writeEntity</span></a><span> </span><a href="#local-6989586621679142140"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-261"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">Core.FieldDefinition</span></a><span> </span><a href="#local-6989586621679142141"><span class="hs-identifier hs-type">nullability</span></a><span> </span><a href="#local-6989586621679142137"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-262"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142137"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-263"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679142142"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-264"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="#local-6989586621679142142"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-265"></a><a name="assertFound"><a href="Database.Orville.PostgreSQL.Plan.html#assertFound"><span class="hs-identifier">assertFound</span></a></a><span> </span><a name="local-6989586621679142198"><a href="#local-6989586621679142198"><span class="hs-identifier">tableDef</span></a></a><span> </span><a name="local-6989586621679142199"><a href="#local-6989586621679142199"><span class="hs-identifier">fieldDef</span></a></a><span> </span><a name="local-6989586621679142200"><a href="#local-6989586621679142200"><span class="hs-identifier">param</span></a></a><span> </span><a name="local-6989586621679142201"><a href="#local-6989586621679142201"><span class="hs-identifier">maybeRecord</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-266"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142201"><span class="hs-identifier hs-var">maybeRecord</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-267"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679142202"><a href="#local-6989586621679142202"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-268"></a><span>      </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679142202"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-271"></a><span>      </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-272"></a><span>        </span><span class="hs-identifier hs-var">unwords</span><span>
</span><a name="line-273"></a><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;Failed to find record in table&quot;</span><span>
</span><a name="line-274"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Core.tableName</span><span> </span><a href="#local-6989586621679142198"><span class="hs-identifier hs-var">tableDef</span></a><span>
</span><a name="line-275"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;where&quot;</span><span>
</span><a name="line-276"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Core.fieldName</span><span> </span><a href="#local-6989586621679142199"><span class="hs-identifier hs-var">fieldDef</span></a><span>
</span><a name="line-277"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot; = &quot;</span><span>
</span><a name="line-278"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679142200"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-279"></a><span>          </span><span class="hs-special">]</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">{-|
  'findAll' constructs a 'Plan' that will find all the rows from the given
  table there the plan's input value matches the given database field.
-}</span><span>
</span><a name="line-285"></a><span class="hs-identifier">findAll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679142131"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-286"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">Core.TableDefinition</span></a><span> </span><a href="#local-6989586621679142132"><span class="hs-identifier hs-type">readEntity</span></a><span> </span><a href="#local-6989586621679142133"><span class="hs-identifier hs-type">writeEntity</span></a><span> </span><a href="#local-6989586621679142134"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-287"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">Core.FieldDefinition</span></a><span> </span><a href="#local-6989586621679142135"><span class="hs-identifier hs-type">nullability</span></a><span> </span><a href="#local-6989586621679142131"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-288"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142136"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142131"><span class="hs-identifier hs-type">fieldValue</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679142132"><span class="hs-identifier hs-type">readEntity</span></a><span class="hs-special">]</span><span>
</span><a name="line-289"></a><a name="findAll"><a href="Database.Orville.PostgreSQL.Plan.html#findAll"><span class="hs-identifier">findAll</span></a></a><span> </span><a name="local-6989586621679142203"><a href="#local-6989586621679142203"><span class="hs-identifier">tableDef</span></a></a><span> </span><a name="local-6989586621679142204"><a href="#local-6989586621679142204"><span class="hs-identifier">fieldDef</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-290"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier hs-var">planOperation</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#findAll"><span class="hs-identifier hs-var">Op.findAll</span></a><span> </span><a href="#local-6989586621679142203"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142204"><span class="hs-identifier hs-var">fieldDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-comment">{-|
  'findAllWhere' is similar to 'findAll', but allows a 'WhereCondition' to be
  specified to restrict which rows are matched by the database query.
-}</span><span>
</span><a name="line-296"></a><span class="hs-identifier">findAllWhere</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679142125"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-297"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">Core.TableDefinition</span></a><span> </span><a href="#local-6989586621679142126"><span class="hs-identifier hs-type">readEntity</span></a><span> </span><a href="#local-6989586621679142127"><span class="hs-identifier hs-type">writeEntity</span></a><span> </span><a href="#local-6989586621679142128"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-298"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">Core.FieldDefinition</span></a><span> </span><a href="#local-6989586621679142129"><span class="hs-identifier hs-type">nullability</span></a><span> </span><a href="#local-6989586621679142125"><span class="hs-identifier hs-type">fieldValue</span></a><span>
</span><a name="line-299"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#WhereCondition"><span class="hs-identifier hs-type">Core.WhereCondition</span></a><span>
</span><a name="line-300"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142130"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142125"><span class="hs-identifier hs-type">fieldValue</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679142126"><span class="hs-identifier hs-type">readEntity</span></a><span class="hs-special">]</span><span>
</span><a name="line-301"></a><a name="findAllWhere"><a href="Database.Orville.PostgreSQL.Plan.html#findAllWhere"><span class="hs-identifier">findAllWhere</span></a></a><span> </span><a name="local-6989586621679142205"><a href="#local-6989586621679142205"><span class="hs-identifier">tableDef</span></a></a><span> </span><a name="local-6989586621679142206"><a href="#local-6989586621679142206"><span class="hs-identifier">fieldDef</span></a></a><span> </span><a name="local-6989586621679142207"><a href="#local-6989586621679142207"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-302"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#planOperation"><span class="hs-identifier hs-var">planOperation</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#findAllWhere"><span class="hs-identifier hs-var">Op.findAllWhere</span></a><span> </span><a href="#local-6989586621679142205"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><a href="#local-6989586621679142206"><span class="hs-identifier hs-var">fieldDef</span></a><span> </span><a href="#local-6989586621679142207"><span class="hs-identifier hs-var">cond</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">{-|
  'planMany' adapts a plan that takes a single input parameter to work on
  multiple input parameters. When the new plan is executed each query will
  execute in the same basic order, but with adjusted conditions to find all the
  rows for all inputs at once rather than running the planned queries once for
  each input.
-}</span><span>
</span><a name="line-311"></a><span class="hs-identifier">planMany</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679142124"><a href="#local-6989586621679142124"><span class="hs-identifier">manyScope</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142124"><span class="hs-identifier hs-type">manyScope</span></a><span> </span><a href="#local-6989586621679142121"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142122"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142123"><span class="hs-identifier hs-type">scope</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679142121"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a><span> </span><a href="#local-6989586621679142121"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142122"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-313"></a><a name="planMany"><a href="Database.Orville.PostgreSQL.Plan.html#planMany"><span class="hs-identifier">planMany</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-314"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanMany"><span class="hs-identifier hs-var">PlanMany</span></a><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-comment">{-|
  'bind' gives access to the results of a plan to use as input values to future
  plans. The plan result is given the input parameter to the provided function,
  which must produce the remaining 'Plan' to be executed. The value will be
  wrapped in the 'Planned' type, which may represent either a result or
  multiple results, depending on whether one plan is currently be executed with
  one and multiple input parameters. This ensures that the caller produces only
  a single remaining 'Plan' to be used for all inputs when there are multiple
  to eliminate the need to possibly run different queries for different inputs
  (which would an introduce N+1 query execution).

  The 'Planned' value (or values) provided by 'bind' have actually been
  retrieved from the database, so the value can be used multiple times when
  constructing the remaining 'Plan' without fear of causing the query to run
  multiple times.

  Also see 'use' for how to lift a 'Planned' value back into a 'Plan'.
-}</span><span>
</span><a name="line-334"></a><span class="hs-identifier">bind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142117"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142118"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142119"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-335"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142117"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142119"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142117"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142118"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142120"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142117"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142118"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142120"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-337"></a><a name="bind"><a href="Database.Orville.PostgreSQL.Plan.html#bind"><span class="hs-identifier">bind</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-338"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#Bind"><span class="hs-identifier hs-var">Bind</span></a><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-comment">{-|
  'use' constructs a 'Plan' that always produces the 'Planned' value
  as its result, regardless of the parameter given as input to the plan.
-}</span><span>
</span><a name="line-344"></a><span class="hs-identifier">use</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142114"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142115"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142114"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142116"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142115"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-345"></a><a name="use"><a href="Database.Orville.PostgreSQL.Plan.html#use"><span class="hs-identifier">use</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-346"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#Use"><span class="hs-identifier hs-var">Use</span></a><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">{-|
  'using' uses a 'Planned' value in the input to another 'Plan'. The
  resulting plan will ignore its input and use the 'Planned' value as
  the input to produce its result instead.
-}</span><span>
</span><a name="line-353"></a><span class="hs-identifier">using</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Planned"><span class="hs-identifier hs-type">Planned</span></a><span> </span><a href="#local-6989586621679142109"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142110"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-354"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679142113"><a href="#local-6989586621679142113"><span class="hs-identifier">usingScope</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142113"><span class="hs-identifier hs-type">usingScope</span></a><span> </span><a href="#local-6989586621679142110"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679142111"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142109"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142112"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142111"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-356"></a><a name="using"><a href="Database.Orville.PostgreSQL.Plan.html#using"><span class="hs-identifier">using</span></a></a><span> </span><a name="local-6989586621679142208"><a href="#local-6989586621679142208"><span class="hs-identifier">planned</span></a></a><span> </span><a name="local-6989586621679142209"><a href="#local-6989586621679142209"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-357"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#chain"><span class="hs-identifier hs-var">chain</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#use"><span class="hs-identifier hs-var">use</span></a><span> </span><a href="#local-6989586621679142208"><span class="hs-identifier hs-var">planned</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679142209"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-comment">{-|
  'apply' applies a function produced by a plan to the value produced
  by another plan. This is usually used via the '&lt;*&gt;' operator through
  the 'Applicative' instance for 'Plan'.
-}</span><span>
</span><a name="line-364"></a><span class="hs-identifier">apply</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142105"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142106"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679142107"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142108"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142105"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142106"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142107"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-366"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142105"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142106"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142108"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-367"></a><a name="apply"><a href="Database.Orville.PostgreSQL.Plan.html#apply"><span class="hs-identifier">apply</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-368"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-comment">{-|
  'chain' connects the output of one plan to the input of another to form a
  larger plan that will execute the first followed by the second.
-}</span><span>
</span><a name="line-374"></a><span class="hs-identifier">chain</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142100"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142101"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679142102"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-375"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679142104"><a href="#local-6989586621679142104"><span class="hs-identifier">chainedScope</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142104"><span class="hs-identifier hs-type">chainedScope</span></a><span> </span><a href="#local-6989586621679142102"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679142103"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142100"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142101"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679142103"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-377"></a><a name="chain"><a href="Database.Orville.PostgreSQL.Plan.html#chain"><span class="hs-identifier">chain</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-378"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#Chain"><span class="hs-identifier hs-var">Chain</span></a><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span class="hs-comment">{-|
  'assert' allows you to make an assertion about a plans result that will throw
  an 'Op.AssertionFailed' failed exception during execution if it proves to be
  false. The first parameter is the assertion function, which should return
  either an error message to be given in the exception or the value to be used
  as the plan's result.
-}</span><span>
</span><a name="line-387"></a><span class="hs-identifier">assert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679142096"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142097"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="#local-6989586621679142098"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142099"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142096"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142097"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-389"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142099"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142096"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142098"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-390"></a><a name="assert"><a href="Database.Orville.PostgreSQL.Plan.html#assert"><span class="hs-identifier">assert</span></a></a><span> </span><a name="local-6989586621679142210"><a href="#local-6989586621679142210"><span class="hs-identifier">assertion</span></a></a><span> </span><a name="local-6989586621679142211"><a href="#local-6989586621679142211"><span class="hs-identifier">aPlan</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-391"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-392"></a><span>    </span><a name="local-6989586621679142212"><a href="#local-6989586621679142212"><span class="hs-identifier">eitherPlan</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-393"></a><span>      </span><a href="#local-6989586621679142210"><span class="hs-identifier hs-var">assertion</span></a><span>
</span><a name="line-394"></a><span>        </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#askParam"><span class="hs-identifier hs-var">askParam</span></a><span>
</span><a name="line-395"></a><span>        </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679142211"><span class="hs-identifier hs-var">aPlan</span></a><span>
</span><a name="line-396"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-397"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#chain"><span class="hs-identifier hs-var">chain</span></a><span> </span><a href="#local-6989586621679142212"><span class="hs-identifier hs-var">eitherPlan</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#PlanOp"><span class="hs-identifier hs-var">PlanOp</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.Operation.html#assertRight"><span class="hs-identifier hs-var">Op.assertRight</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-comment">{-|
  'execute' accepts the input parameter (or parameters) expected by a 'Plan'
  and runs the plan to completion, either throwing an 'Op.AssertionFailed'
  exception in the monad 'm' or producing the expected result.

  If you have a plan that takes one input and want to provide a list of
  input, use 'planMany' to adapt it to a multple-input plan before calling
  'execute'.
-}</span><span>
</span><a name="line-408"></a><span class="hs-identifier">execute</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Monad.html#MonadOrville"><span class="hs-identifier hs-type">Core.MonadOrville</span></a><span> </span><a href="#local-6989586621679142091"><span class="hs-identifier hs-type">conn</span></a><span> </span><a href="#local-6989586621679142092"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-409"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679142095"><a href="#local-6989586621679142095"><span class="hs-identifier">scope</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142095"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142093"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142094"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142093"><span class="hs-identifier hs-type">param</span></a><span>
</span><a name="line-411"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142092"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679142094"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-412"></a><a name="execute"><a href="Database.Orville.PostgreSQL.Plan.html#execute"><span class="hs-identifier">execute</span></a></a><span> </span><a name="local-6989586621679142213"><a href="#local-6989586621679142213"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679142214"><a href="#local-6989586621679142214"><span class="hs-identifier">param</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-413"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier hs-var">executeOne</span></a><span> </span><a href="#local-6989586621679142213"><span class="hs-identifier hs-var">plan</span></a><span> </span><a href="#local-6989586621679142214"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span class="hs-comment">{-|
  'executeOne' is an internal helper that executes a 'Plan' with a concrete
  'scope' type to ensure all 'Planned' values are built with 'PlannedOne'.
-}</span><span>
</span><a name="line-419"></a><span class="hs-identifier">executeOne</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Monad.html#MonadOrville"><span class="hs-identifier hs-type">Core.MonadOrville</span></a><span> </span><a href="#local-6989586621679142087"><span class="hs-identifier hs-type">conn</span></a><span> </span><a href="#local-6989586621679142088"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-420"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#OneScope"><span class="hs-identifier hs-type">OneScope</span></a><span> </span><a href="#local-6989586621679142089"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142090"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-421"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142089"><span class="hs-identifier hs-type">param</span></a><span>
</span><a name="line-422"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142088"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679142090"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-423"></a><a name="executeOne"><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier">executeOne</span></a></a><span> </span><a name="local-6989586621679142215"><a href="#local-6989586621679142215"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679142216"><a href="#local-6989586621679142216"><span class="hs-identifier">param</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-424"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142215"><span class="hs-identifier hs-var">plan</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-425"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanOp"><span class="hs-identifier hs-var">PlanOp</span></a><span> </span><a name="local-6989586621679142217"><a href="#local-6989586621679142217"><span class="hs-identifier">operation</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-426"></a><span>      </span><a name="local-6989586621679142218"><a href="#local-6989586621679142218"><span class="hs-identifier">opResult</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">Op.executeOperationOne</span><span> </span><a href="#local-6989586621679142217"><span class="hs-identifier hs-var">operation</span></a><span> </span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142218"><span class="hs-identifier hs-var">opResult</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-429"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679142219"><a href="#local-6989586621679142219"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-430"></a><span>          </span><span class="hs-identifier hs-var">Catch.throwM</span><span> </span><a href="#local-6989586621679142219"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679142220"><a href="#local-6989586621679142220"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-433"></a><span>          </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679142220"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-434"></a><span>
</span><a name="line-435"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanMany"><span class="hs-identifier hs-var">PlanMany</span></a><span> </span><a name="local-6989586621679142221"><a href="#local-6989586621679142221"><span class="hs-identifier">manyPlan</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-436"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span> </span><a href="#local-6989586621679142221"><span class="hs-identifier hs-var">manyPlan</span></a><span> </span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Bind"><span class="hs-identifier hs-var">Bind</span></a><span> </span><a name="local-6989586621679142222"><a href="#local-6989586621679142222"><span class="hs-identifier">intermPlan</span></a></a><span> </span><a name="local-6989586621679142223"><a href="#local-6989586621679142223"><span class="hs-identifier">continue</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-439"></a><span>      </span><a name="local-6989586621679142224"><a href="#local-6989586621679142224"><span class="hs-identifier">interm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier hs-var">executeOne</span></a><span> </span><a href="#local-6989586621679142222"><span class="hs-identifier hs-var">intermPlan</span></a><span> </span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-440"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier hs-var">executeOne</span></a><span>
</span><a name="line-441"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621679142223"><span class="hs-identifier hs-var">continue</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedOne"><span class="hs-identifier hs-var">PlannedOne</span></a><span> </span><a href="#local-6989586621679142224"><span class="hs-identifier hs-var">interm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>        </span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Use"><span class="hs-identifier hs-var">Use</span></a><span> </span><a name="local-6989586621679142225"><a href="#local-6989586621679142225"><span class="hs-identifier">planned</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-445"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#resolveOne"><span class="hs-identifier hs-var">resolveOne</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679142225"><span class="hs-identifier hs-var">planned</span></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Pure"><span class="hs-identifier hs-var">Pure</span></a><span> </span><a name="local-6989586621679142226"><a href="#local-6989586621679142226"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-448"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679142226"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span> </span><a name="local-6989586621679142227"><a href="#local-6989586621679142227"><span class="hs-identifier">planF</span></a></a><span> </span><a name="local-6989586621679142228"><a href="#local-6989586621679142228"><span class="hs-identifier">planA</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-451"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier hs-var">executeOne</span></a><span> </span><a href="#local-6989586621679142227"><span class="hs-identifier hs-var">planF</span></a><span> </span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">param</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier hs-var">executeOne</span></a><span> </span><a href="#local-6989586621679142228"><span class="hs-identifier hs-var">planA</span></a><span> </span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Chain"><span class="hs-identifier hs-var">Chain</span></a><span> </span><a name="local-6989586621679142229"><a href="#local-6989586621679142229"><span class="hs-identifier">planAB</span></a></a><span> </span><a name="local-6989586621679142230"><a href="#local-6989586621679142230"><span class="hs-identifier">planBC</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-454"></a><span>      </span><a name="local-6989586621679142231"><a href="#local-6989586621679142231"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier hs-var">executeOne</span></a><span> </span><a href="#local-6989586621679142229"><span class="hs-identifier hs-var">planAB</span></a><span> </span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-455"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#executeOne"><span class="hs-identifier hs-var">executeOne</span></a><span> </span><a href="#local-6989586621679142230"><span class="hs-identifier hs-var">planBC</span></a><span> </span><a href="#local-6989586621679142231"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-comment">{-|
  'executeMany' is an internal helper that executes a 'Plan' with a concrete
  @scope@ type to ensure all 'Planned' values are built with 'PlannedMany'.
-}</span><span>
</span><a name="line-461"></a><span class="hs-identifier">executeMany</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Monad.html#MonadOrville"><span class="hs-identifier hs-type">Core.MonadOrville</span></a><span> </span><a href="#local-6989586621679142083"><span class="hs-identifier hs-type">conn</span></a><span> </span><a href="#local-6989586621679142084"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-462"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#ManyScope"><span class="hs-identifier hs-type">ManyScope</span></a><span> </span><a href="#local-6989586621679142085"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679142085"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142086"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-463"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679142085"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">]</span><span>
</span><a name="line-464"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679142084"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many.Many</span></a><span> </span><a href="#local-6989586621679142085"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142086"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-465"></a><a name="executeMany"><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier">executeMany</span></a></a><span> </span><a name="local-6989586621679142232"><a href="#local-6989586621679142232"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679142233"><a href="#local-6989586621679142233"><span class="hs-identifier">params</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-466"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142232"><span class="hs-identifier hs-var">plan</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-467"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanOp"><span class="hs-identifier hs-var">PlanOp</span></a><span> </span><a name="local-6989586621679142234"><a href="#local-6989586621679142234"><span class="hs-identifier">operation</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-468"></a><span>      </span><a name="local-6989586621679142235"><a href="#local-6989586621679142235"><span class="hs-identifier">opResult</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">Op.executeOperationMany</span><span> </span><a href="#local-6989586621679142234"><span class="hs-identifier hs-var">operation</span></a><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142235"><span class="hs-identifier hs-var">opResult</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-471"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679142236"><a href="#local-6989586621679142236"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-472"></a><span>          </span><span class="hs-identifier hs-var">Catch.throwM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679142236"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679142237"><a href="#local-6989586621679142237"><span class="hs-identifier">results</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-475"></a><span>          </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679142237"><span class="hs-identifier hs-var">results</span></a><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanMany"><span class="hs-identifier hs-var">PlanMany</span></a><span> </span><a name="local-6989586621679142238"><a href="#local-6989586621679142238"><span class="hs-identifier">manyPlan</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-478"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-479"></a><span>        </span><a name="local-6989586621679142239"><a href="#local-6989586621679142239"><span class="hs-identifier">flatParams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-480"></a><span>
</span><a name="line-481"></a><span>      </span><a name="local-6989586621679142240"><a href="#local-6989586621679142240"><span class="hs-identifier">allResults</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span> </span><a href="#local-6989586621679142238"><span class="hs-identifier hs-var">manyPlan</span></a><span> </span><a href="#local-6989586621679142239"><span class="hs-identifier hs-var">flatParams</span></a><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-484"></a><span>        </span><a name="local-6989586621679142241"><a href="#local-6989586621679142241"><span class="hs-identifier">restrictResults</span></a></a><span> </span><a name="local-6989586621679142242"><a href="#local-6989586621679142242"><span class="hs-identifier">subParams</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-485"></a><span>          </span><a href="Database.Orville.PostgreSQL.Plan.Many.html#fromKeys"><span class="hs-identifier hs-var">Many.fromKeys</span></a><span> </span><a href="#local-6989586621679142242"><span class="hs-identifier hs-var">subParams</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679142243"><a href="#local-6989586621679142243"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Many.html#lookup"><span class="hs-identifier hs-var">Many.lookup</span></a><span> </span><a href="#local-6989586621679142243"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679142240"><span class="hs-identifier hs-var">allResults</span></a><span class="hs-special">)</span><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Many.html#fromKeys"><span class="hs-identifier hs-var">Many.fromKeys</span></a><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679142241"><span class="hs-identifier hs-var">restrictResults</span></a><span class="hs-special">)</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Bind"><span class="hs-identifier hs-var">Bind</span></a><span> </span><a name="local-6989586621679142244"><a href="#local-6989586621679142244"><span class="hs-identifier">intermPlan</span></a></a><span> </span><a name="local-6989586621679142245"><a href="#local-6989586621679142245"><span class="hs-identifier">continue</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-490"></a><span>      </span><a name="local-6989586621679142246"><a href="#local-6989586621679142246"><span class="hs-identifier">interms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span> </span><a href="#local-6989586621679142244"><span class="hs-identifier hs-var">intermPlan</span></a><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-491"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span>
</span><a name="line-492"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621679142245"><span class="hs-identifier hs-var">continue</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedMany"><span class="hs-identifier hs-var">PlannedMany</span></a><span> </span><a href="#local-6989586621679142246"><span class="hs-identifier hs-var">interms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>        </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-494"></a><span>
</span><a name="line-495"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Use"><span class="hs-identifier hs-var">Use</span></a><span> </span><a name="local-6989586621679142247"><a href="#local-6989586621679142247"><span class="hs-identifier">planned</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-496"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#resolveMany"><span class="hs-identifier hs-var">resolveMany</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679142247"><span class="hs-identifier hs-var">planned</span></a><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Pure"><span class="hs-identifier hs-var">Pure</span></a><span> </span><a name="local-6989586621679142248"><a href="#local-6989586621679142248"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-499"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Many.html#fromKeys"><span class="hs-identifier hs-var">Many.fromKeys</span></a><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679142248"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span> </span><a name="local-6989586621679142249"><a href="#local-6989586621679142249"><span class="hs-identifier">planF</span></a></a><span> </span><a name="local-6989586621679142250"><a href="#local-6989586621679142250"><span class="hs-identifier">planA</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-502"></a><span>      </span><a name="local-6989586621679142251"><a href="#local-6989586621679142251"><span class="hs-identifier">manyFs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span> </span><a href="#local-6989586621679142249"><span class="hs-identifier hs-var">planF</span></a><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-503"></a><span>      </span><a name="local-6989586621679142252"><a href="#local-6989586621679142252"><span class="hs-identifier">manyAs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span> </span><a href="#local-6989586621679142250"><span class="hs-identifier hs-var">planA</span></a><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Many.html#apply"><span class="hs-identifier hs-var">Many.apply</span></a><span> </span><a href="#local-6989586621679142251"><span class="hs-identifier hs-var">manyFs</span></a><span> </span><a href="#local-6989586621679142252"><span class="hs-identifier hs-var">manyAs</span></a><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Chain"><span class="hs-identifier hs-var">Chain</span></a><span> </span><a name="local-6989586621679142253"><a href="#local-6989586621679142253"><span class="hs-identifier">planAB</span></a></a><span> </span><a name="local-6989586621679142254"><a href="#local-6989586621679142254"><span class="hs-identifier">planBC</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-508"></a><span>      </span><a name="local-6989586621679142255"><a href="#local-6989586621679142255"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span> </span><a href="#local-6989586621679142253"><span class="hs-identifier hs-var">planAB</span></a><span> </span><a href="#local-6989586621679142233"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-509"></a><span>      </span><a name="local-6989586621679142256"><a href="#local-6989586621679142256"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#executeMany"><span class="hs-identifier hs-var">executeMany</span></a><span> </span><a href="#local-6989586621679142254"><span class="hs-identifier hs-var">planBC</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Plan.Many.html#elems"><span class="hs-identifier hs-var">Many.elems</span></a><span> </span><a href="#local-6989586621679142255"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Many.html#compose"><span class="hs-identifier hs-var">Many.compose</span></a><span> </span><a href="#local-6989586621679142256"><span class="hs-identifier hs-var">cs</span></a><span> </span><a href="#local-6989586621679142255"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-comment">{-|
  'Explain' is an internal type used to track whether an explanation is
  being generated for a single input or multiple inputs.
-}</span><span>
</span><a name="line-516"></a><span class="hs-keyword">data</span><span> </span><a name="Explain"><a href="Database.Orville.PostgreSQL.Plan.html#Explain"><span class="hs-identifier">Explain</span></a></a><span>
</span><a name="line-517"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ExplainOne"><a href="Database.Orville.PostgreSQL.Plan.html#ExplainOne"><span class="hs-identifier">ExplainOne</span></a></a><span>
</span><a name="line-518"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ExplainMany"><a href="Database.Orville.PostgreSQL.Plan.html#ExplainMany"><span class="hs-identifier">ExplainMany</span></a></a><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-comment">{-|
  'explain' produces a textual description of the steps outlined by
  a 'Plan' -- in most cases example SQL queries. If you want to see
  the explanation of how the plan will run with multiple input parameters,
  you can use 'planMany' to adapt it before calling 'explain'.
-}</span><span>
</span><a name="line-526"></a><span class="hs-identifier">explain</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679142082"><a href="#local-6989586621679142082"><span class="hs-identifier">scope</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="#local-6989586621679142082"><span class="hs-identifier hs-type">scope</span></a><span> </span><a href="#local-6989586621679142080"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142081"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-527"></a><a name="explain"><a href="Database.Orville.PostgreSQL.Plan.html#explain"><span class="hs-identifier">explain</span></a></a><span> </span><a name="local-6989586621679142257"><a href="#local-6989586621679142257"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-528"></a><span>  </span><a href="Database.Orville.PostgreSQL.Plan.Explanation.html#explanationSteps"><span class="hs-identifier hs-var">Exp.explanationSteps</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-529"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#ExplainOne"><span class="hs-identifier hs-var">ExplainOne</span></a><span> </span><a href="#local-6989586621679142257"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span class="hs-comment">{-|
  'explainPlan' is an internal helper to executes a plan with the
  'scope' type fixed to 'Explain' to ensure that all 'Planned'
  values are constructed with the 'PlannedExplain' constructor.
-}</span><span>
</span><a name="line-536"></a><span class="hs-identifier">explainPlan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Explain"><span class="hs-identifier hs-type">Explain</span></a><span>
</span><a name="line-537"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#Explain"><span class="hs-identifier hs-type">Explain</span></a><span> </span><a href="#local-6989586621679142078"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679142079"><span class="hs-identifier hs-type">result</span></a><span>
</span><a name="line-538"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.Explanation.html#Explanation"><span class="hs-identifier hs-type">Exp.Explanation</span></a><span>
</span><a name="line-539"></a><a name="explainPlan"><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier">explainPlan</span></a></a><span> </span><a name="local-6989586621679142258"><a href="#local-6989586621679142258"><span class="hs-identifier">mult</span></a></a><span> </span><a name="local-6989586621679142259"><a href="#local-6989586621679142259"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-540"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142259"><span class="hs-identifier hs-var">plan</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-541"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanOp"><span class="hs-identifier hs-var">PlanOp</span></a><span> </span><a name="local-6989586621679142260"><a href="#local-6989586621679142260"><span class="hs-identifier">operation</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-542"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679142258"><span class="hs-identifier hs-var">mult</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-543"></a><span>        </span><a href="Database.Orville.PostgreSQL.Plan.html#ExplainOne"><span class="hs-identifier hs-var">ExplainOne</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-544"></a><span>          </span><span class="hs-identifier">Op.explainOperationOne</span><span> </span><a href="#local-6989586621679142260"><span class="hs-identifier hs-var">operation</span></a><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span>        </span><a href="Database.Orville.PostgreSQL.Plan.html#ExplainMany"><span class="hs-identifier hs-var">ExplainMany</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-547"></a><span>          </span><span class="hs-identifier">Op.explainOperationMany</span><span> </span><a href="#local-6989586621679142260"><span class="hs-identifier hs-var">operation</span></a><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#PlanMany"><span class="hs-identifier hs-var">PlanMany</span></a><span> </span><a name="local-6989586621679142261"><a href="#local-6989586621679142261"><span class="hs-identifier">manyPlan</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-550"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#ExplainMany"><span class="hs-identifier hs-var">ExplainMany</span></a><span> </span><a href="#local-6989586621679142261"><span class="hs-identifier hs-var">manyPlan</span></a><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Bind"><span class="hs-identifier hs-var">Bind</span></a><span> </span><a name="local-6989586621679142262"><a href="#local-6989586621679142262"><span class="hs-identifier">intermPlan</span></a></a><span> </span><a name="local-6989586621679142263"><a href="#local-6989586621679142263"><span class="hs-identifier">continue</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-553"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-554"></a><span>        </span><a name="local-6989586621679142264"><a href="#local-6989586621679142264"><span class="hs-identifier">nextPlan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679142263"><span class="hs-identifier hs-var">continue</span></a><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#PlannedExplain"><span class="hs-identifier hs-var">PlannedExplain</span></a><span>
</span><a name="line-555"></a><span>      </span><span class="hs-keyword">in</span><span>
</span><a name="line-556"></a><span>        </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="#local-6989586621679142258"><span class="hs-identifier hs-var">mult</span></a><span> </span><a href="#local-6989586621679142262"><span class="hs-identifier hs-var">intermPlan</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="#local-6989586621679142258"><span class="hs-identifier hs-var">mult</span></a><span> </span><a href="#local-6989586621679142264"><span class="hs-identifier hs-var">nextPlan</span></a><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Use"><span class="hs-identifier hs-var">Use</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-559"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.Explanation.html#noExplanation"><span class="hs-identifier hs-var">Exp.noExplanation</span></a><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Pure"><span class="hs-identifier hs-var">Pure</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-562"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.Explanation.html#noExplanation"><span class="hs-identifier hs-var">Exp.noExplanation</span></a><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span> </span><a name="local-6989586621679142265"><a href="#local-6989586621679142265"><span class="hs-identifier">planF</span></a></a><span> </span><a name="local-6989586621679142266"><a href="#local-6989586621679142266"><span class="hs-identifier">planA</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-565"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="#local-6989586621679142258"><span class="hs-identifier hs-var">mult</span></a><span> </span><a href="#local-6989586621679142265"><span class="hs-identifier hs-var">planF</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="#local-6989586621679142258"><span class="hs-identifier hs-var">mult</span></a><span> </span><a href="#local-6989586621679142266"><span class="hs-identifier hs-var">planA</span></a><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span>    </span><a href="Database.Orville.PostgreSQL.Plan.html#Chain"><span class="hs-identifier hs-var">Chain</span></a><span> </span><a name="local-6989586621679142267"><a href="#local-6989586621679142267"><span class="hs-identifier">planAB</span></a></a><span> </span><a name="local-6989586621679142268"><a href="#local-6989586621679142268"><span class="hs-identifier">planBC</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-568"></a><span>      </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="#local-6989586621679142258"><span class="hs-identifier hs-var">mult</span></a><span> </span><a href="#local-6989586621679142267"><span class="hs-identifier hs-var">planAB</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Plan.html#explainPlan"><span class="hs-identifier hs-var">explainPlan</span></a><span> </span><a href="#local-6989586621679142258"><span class="hs-identifier hs-var">mult</span></a><span> </span><a href="#local-6989586621679142268"><span class="hs-identifier hs-var">planBC</span></a><span>
</span><a name="line-569"></a><span>
</span><a name="line-570"></a></pre></body></html>